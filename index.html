<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GCSE Study ‚Äì English & Science</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#05010b" />
  <style>
    :root{
      --bg:#05010b;
      --panel:#090317;
      --panel-soft:#0b041b;
      --border:#26163b;
      --accent:#ec4899;
      --accent-soft:rgba(236,72,153,.16);
      --accent-strong:#f97316;
      --text:#f9fafb;
      --muted:#9ca3af;
      --radius-lg:18px;
      --radius-md:12px;
      --shadow:0 20px 40px rgba(0,0,0,.9);
      --fast:.12s ease-out;
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0;height:100%}
    body{
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#160322 0,#05010b 45%,#020009 100%);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      display:flex;
      flex-direction:column;
      overscroll-behavior-y:none;
    }

    @keyframes floatUp{from{opacity:0;transform:translateY(6px) scale(.99)}to{opacity:1;transform:translateY(0) scale(1)}}
    @keyframes fadeInView{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}

    /* ---------- iPad 10.9" (landscape) target tweaks ---------- */
    :root{
      --maxw: 1100px;
      --padX: 14px;
      --padY: 10px;
    }

    /* iPad 10.9" landscape: more breathing room + better tap targets */
    @media (min-width: 900px) and (pointer: coarse){
      :root{
        --maxw: 1180px;
        --padX: 20px;
        --padY: 14px;
      }
      button{padding:10px 14px;font-size:14px}
      button.small{padding:7px 12px;font-size:12px}
      .tab-btn{font-size:11px}
      .search-bar input{font-size:14px}
      .panel-header h2{font-size:16px}
      .panel-body{font-size:14px}
      .flashcard-text{font-size:18px}
    }

    /* HEADER */
    .app-header{
      position:sticky;top:0;z-index:20;
      padding-top:env(safe-area-inset-top);
      background:rgba(5,1,11,.98);
      backdrop-filter:blur(18px);
      border-bottom:1px solid rgba(148,27,84,.45);
    }
    .app-header-inner{
      max-width:var(--maxw);
      margin:0 auto;
      padding:10px var(--padX) 10px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .header-row-top{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand-block{display:flex;align-items:center;gap:10px}
    .brand-dot{
      width:26px;height:26px;border-radius:999px;
      background:radial-gradient(circle at 30% 30%,#fee2e2 0,#ec4899 40%,#4c1d95 80%);
      box-shadow:0 0 20px rgba(236,72,153,.9),0 0 34px rgba(147,51,234,.8);
    }
    .brand-text-main{font-size:17px;font-weight:800;text-transform:uppercase;letter-spacing:.18em}
    .brand-text-sub{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.14em}

    .header-right{display:flex;flex-direction:column;align-items:flex-end;gap:8px;flex-shrink:0}
    .subject-toggle{display:flex;background:rgba(15,23,42,.96);border-radius:999px;border:1px solid var(--border);padding:3px;gap:3px}
    .subject-btn{
      border:none;border-radius:999px;padding:6px 11px;font-size:12px;color:var(--muted);
      background:transparent;cursor:pointer;transition:background var(--fast),color var(--fast),transform var(--fast)
    }
    .subject-btn.active{background:var(--accent-soft);color:var(--text);transform:translateY(-1px)}

    .theme-select-wrap{display:flex;flex-direction:column;gap:2px;font-size:11px;color:var(--muted)}
    .theme-select-wrap select{
      background:rgba(15,23,42,.96);color:var(--text);border-radius:999px;border:1px solid var(--border);
      padding:7px 11px;font-size:12px;outline:none;transition:border var(--fast),box-shadow var(--fast),background var(--fast),transform var(--fast)
    }
    .theme-select-wrap select:focus{border-color:var(--accent);box-shadow:0 0 0 1px var(--accent);background:#020013;transform:translateY(-1px)}

    .header-row-search{display:flex;align-items:center;gap:10px}
    .search-bar{
      flex:1;display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:999px;
      background:rgba(15,23,42,.96);border:1px solid rgba(148,163,184,.7)
    }
    .search-bar span{font-size:15px;opacity:.8}
    .search-bar input{border:none;background:transparent;color:#e5e7eb;font-size:13px;outline:none;width:100%}
    .search-bar input::placeholder{color:rgba(148,163,184,.9)}
    .search-button{
      border-radius:999px;border:none;background:#3b82f6;color:#eff6ff;font-size:12px;
      padding:10px 14px;font-weight:700;cursor:pointer;flex-shrink:0;
      box-shadow:0 8px 20px rgba(37,99,235,.9);transition:transform var(--fast),box-shadow var(--fast),opacity var(--fast)
    }
    .search-button:active{transform:translateY(1px);box-shadow:none;opacity:.95}

    /* MAIN */
    main{
      flex:1;
      display:flex;
      justify-content:center;
      padding:var(--padY) var(--padX) calc(86px + env(safe-area-inset-bottom));
    }
    .main-inner{max-width:var(--maxw);width:100%}

    section.view{
      display:none;
      min-height:calc(100vh - 170px);
      opacity:0;transform:translateY(4px);
    }
    section.view.active{display:block;animation:fadeInView .2s ease-out forwards}

    .panel{
      background:linear-gradient(145deg,var(--panel) 0%,var(--panel-soft) 100%);
      border-radius:20px;border:1px solid rgba(148,27,84,.6);
      box-shadow:var(--shadow);
      padding:16px 16px 18px;
      margin-bottom:16px;
      animation:floatUp .25s ease-out;
    }
    @media (min-width: 900px){ .panel{padding:18px 20px 20px;margin-bottom:20px} }

    .panel-header{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-bottom:8px}
    .panel-header h2{margin:0;font-size:15px;text-transform:uppercase;letter-spacing:.14em;color:#fee2e2}
    .panel-header small{font-size:11px;color:var(--muted)}
    .panel-body{font-size:13px;color:var(--text)}
    h3{margin:8px 0 4px;font-size:13px;text-transform:uppercase;letter-spacing:.12em;color:#fecaca}
    p{margin:4px 0;line-height:1.6}
    .muted{font-size:12px;color:var(--muted)}

    .grid-two{display:grid;grid-template-columns:minmax(0,1.1fr) minmax(0,1fr);gap:10px}
    @media (max-width: 900px){ .grid-two{grid-template-columns:minmax(0,1fr)} }

    ul.clean{list-style:none;padding-left:0;margin:4px 0 0;font-size:13px}
    ul.clean li{margin-bottom:4px;display:flex;gap:6px}
    ul.clean li span.b{color:var(--accent);font-size:12px;margin-top:1px}
    .chip-row{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
    .chip{font-size:11px;padding:3px 9px;border-radius:999px;border:1px solid rgba(148,27,84,.7);background:rgba(17,24,39,.96);color:var(--muted)}

    /* Buttons */
    button{
      border-radius:999px;border:1px solid rgba(148,27,84,.8);
      background:rgba(15,23,42,.97);color:var(--text);font-size:13px;padding:7px 12px;
      cursor:pointer;display:inline-flex;align-items:center;gap:6px;
      transition:transform var(--fast),box-shadow var(--fast),border var(--fast),background var(--fast),opacity var(--fast);
      -webkit-tap-highlight-color: transparent;
    }
    button.small{padding:4px 9px;font-size:11px}
    button.primary{border-color:rgba(248,113,113,.9);background:linear-gradient(135deg,#f97316,#ec4899)}
    button.soft{border-color:rgba(148,27,84,.7);background:rgba(17,24,39,.96)}
    button:hover{transform:translateY(-1px) scale(1.02);box-shadow:0 0 12px rgba(148,27,84,.9);opacity:.96}
    button:active{transform:translateY(1px) scale(.98);box-shadow:none;opacity:.9}

    select,input[type="text"],textarea{
      background:rgba(15,23,42,.95);
      border-radius:var(--radius-md);
      border:1px solid var(--border);
      color:var(--text);
      padding:10px 12px;
      font-size:13px;
      outline:none;
      width:100%;
      font-family:inherit;
      transition:border var(--fast),box-shadow var(--fast),background var(--fast),transform var(--fast);
    }
    textarea{min-height:60px;resize:vertical}
    select:focus,input[type="text"]:focus,textarea:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(236,72,153,.9);
      background:#020013;
      transform:translateY(-1px);
    }

    /* SEARCH RESULTS */
    .search-results-panel{margin-bottom:10px;display:none}
    .search-results-panel.active{display:block;animation:floatUp .22s ease-out}
    .search-results-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}
    .search-results-header span{font-size:12px;color:var(--muted)}

    .search-result-item{
      border-radius:14px;border:1px solid rgba(55,65,81,.9);
      background:rgba(15,23,42,.96);
      padding:10px 12px;
      font-size:12px;
      margin-bottom:8px;
      cursor:pointer;
      transition:transform var(--fast),box-shadow var(--fast),border var(--fast),background var(--fast);
    }
    .search-result-item:hover{
      transform:translateY(-1px);
      border-color:var(--accent);
      box-shadow:0 0 12px rgba(148,27,84,.7);
      background:rgba(15,23,42,1);
    }
    .search-result-meta{font-size:11px;color:var(--muted);margin-top:3px}

    .today-pill{
      padding:6px 12px;border-radius:999px;
      border:1px solid rgba(148,27,84,.7);
      background:rgba(15,23,42,.97);
      font-size:12px;color:var(--muted);
      display:inline-flex;align-items:center;gap:8px;margin-bottom:10px;
    }
    .today-pill-dot{
      width:7px;height:7px;border-radius:999px;background:#22c55e;
      box-shadow:0 0 10px rgba(34,197,94,.9)
    }

    /* TAB BAR */
    .tabbar{
      position:fixed;left:0;right:0;bottom:0;
      padding:6px 12px calc(8px + env(safe-area-inset-bottom));
      background:radial-gradient(circle at top,rgba(15,23,42,.98) 0,rgba(15,23,42,.98) 40%,rgba(2,6,23,.98) 100%);
      border-top:1px solid rgba(31,41,55,.9);
      backdrop-filter:blur(18px);
      z-index:30;
    }
    .tabbar-inner{
      max-width:520px;margin:0 auto;
      display:flex;justify-content:space-between;align-items:center;gap:10px;
    }
    .tab-btn{
      flex:1;border-radius:999px;border:none;background:transparent;color:var(--muted);
      font-size:10px;padding:7px 6px 6px;
      display:flex;flex-direction:column;align-items:center;gap:3px;
      cursor:pointer;transition:background var(--fast),color var(--fast),transform var(--fast);
    }
    .tab-btn-icon{
      width:24px;height:24px;border-radius:999px;border:1px solid transparent;
      display:flex;align-items:center;justify-content:center;font-size:15px;margin-bottom:1px;
    }
    .tab-btn.active{color:var(--text);background:rgba(15,23,42,.85);transform:translateY(-1px)}
    .tab-btn.active .tab-btn-icon{
      border-color:var(--accent);
      box-shadow:0 0 10px rgba(236,72,153,.9),0 0 18px rgba(148,27,84,.8);
    }

    /* ---------- FLASHCARDS: FULLSCREEN QUIZLET-LIKE ---------- */
    /* Make flashcards page a dedicated "player" that fills the screen on iPad */
    #view-flashcards .panel{
      padding:0;
      overflow:hidden;
    }

    .fc-player{
      min-height:calc(100vh - 210px); /* header + tabbar accounted */
      display:flex;
      flex-direction:column;
    }

    /* Top bar inside flashcards page */
    .fc-topbar{
      padding:14px 14px 12px;
      border-bottom:1px solid rgba(148,27,84,.35);
      background:linear-gradient(180deg, rgba(9,3,23,.92), rgba(5,0,18,.92));
    }

    .fc-top-row{
      display:flex;flex-wrap:wrap;align-items:flex-end;gap:10px;margin:0;
    }
    .fc-top-row label{
      font-size:12px;color:var(--muted);
      display:flex;flex-direction:column;gap:6px;min-width:220px;
      flex:1;
    }
    #deck-info{align-self:center}

    /* Quizlet-like stage */
    .fc-stage{
      flex:1;
      display:flex;
      flex-direction:column;
      justify-content:center;
      padding:16px 14px;
      gap:12px;
    }

    .progress-bar{height:6px;border-radius:999px;background:rgba(148,27,84,.45);overflow:hidden}
    .progress-fill{height:100%;width:0%;background:linear-gradient(90deg,#ec4899,#f97316);transition:width .2s ease-out}

    .flashcard-box{
      flex:1; /* fill remaining space */
      border-radius:20px;
      border:1px solid rgba(148,27,84,.85);
      background:radial-gradient(circle at top left,#11051f 0,#050012 70%);
      padding:18px 18px 16px;
      min-height:0; /* allow flex to size */
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      cursor:pointer;
      transition:border var(--fast),box-shadow var(--fast),transform var(--fast),background var(--fast);
      touch-action: manipulation;
      user-select:none;
    }
    .flashcard-box:hover{
      transform:translateY(-2px) scale(1.01);
      box-shadow:0 0 18px rgba(148,27,84,.9);
      background:radial-gradient(circle at top left,#1a082f 0,#050012 70%);
    }
    .flashcard-box:active{transform:scale(.99)}

    .flashcard-header{
      display:flex;justify-content:space-between;align-items:center;
      font-size:12px;color:var(--muted);margin-bottom:10px;
    }
    .flashcard-tag{
      padding:4px 12px;border-radius:999px;
      border:1px solid rgba(248,113,113,.9);
      background:rgba(15,23,42,.96);
      display:inline-flex;align-items:center;gap:8px;
    }
    .tag-dot{
      width:8px;height:8px;border-radius:999px;background:var(--accent);
      box-shadow:0 0 10px rgba(236,72,153,.9),0 0 18px rgba(248,113,113,.9);
    }

    /* Make text large + centered like Quizlet */
    .flashcard-text{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      font-size:18px;
      line-height:1.65;
      white-space:pre-wrap;
      padding:12px 6px;
    }
    .flashcard-text.empty{font-size:14px;font-style:italic;color:var(--muted)}

    .flashcard-footer{
      display:flex;justify-content:space-between;flex-wrap:wrap;gap:8px;
      margin-top:8px;font-size:12px;color:var(--muted);
    }

    /* Controls row fixed inside flashcards panel bottom */
    .fc-controls{
      padding:12px 14px 14px;
      border-top:1px solid rgba(148,27,84,.35);
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      background:linear-gradient(180deg, rgba(5,0,18,.92), rgba(9,3,23,.92));
    }
    .fc-controls-left, .fc-controls-right{
      display:flex;flex-wrap:wrap;gap:8px;align-items:center;
    }
    .fc-status{padding:0 14px 12px;font-size:12px;color:var(--muted)}
    .fc-status:empty{display:none}

    /* Quick decks row: scrollable on iPad so it doesn‚Äôt wrap messily */
    .quick-decks{
      display:flex;
      gap:8px;
      padding:10px 14px 0;
      overflow:auto;
      -webkit-overflow-scrolling:touch;
      scroll-snap-type:x mandatory;
    }
    .quick-decks button{scroll-snap-align:start;white-space:nowrap}

    /* Reduce motion option */
    @media (prefers-reduced-motion: reduce){
      *{animation:none !important;transition:none !important}
    }

    /* POEMS, TOOLS - keep same content styling (your original) */
    .poem-list{border-radius:var(--radius-md);border:1px solid rgba(148,27,84,.7);background:rgba(15,23,42,.8);padding:6px 8px}
    details.poem-details{border-radius:12px;padding:6px 8px;margin:2px 0;transition:background var(--fast),border var(--fast),transform var(--fast)}
    details.poem-details[open]{background:rgba(15,23,42,.95);border-color:var(--accent);transform:translateY(-1px)}
    .poem-summary{list-style:none;cursor:pointer;display:flex;align-items:center;justify-content:space-between;font-size:13px}
    .poem-title{font-weight:600}
    .poem-chevron{font-size:11px;color:var(--muted);margin-left:8px}
    .poem-body{margin-top:4px;font-size:12px}
    .poem-sub{font-size:11px;text-transform:uppercase;letter-spacing:.16em;color:var(--muted);margin-top:4px}
    .poem-detail{margin:2px 0}

    .tool-card{border-radius:14px;border:1px solid rgba(55,65,81,.9);background:rgba(15,23,42,.92);padding:10px 10px;margin-top:10px;animation:floatUp .25s ease-out}
    .tool-card-header{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .tool-card-title{font-size:12px;text-transform:uppercase;letter-spacing:.16em}
    .tool-card-body{margin-top:8px;font-size:12px}
    .more-content{display:none;margin-top:8px;animation:floatUp .22s ease-out}
    .more-content.open{display:block}

    .mini-label{font-size:11px;color:var(--muted);margin-top:2px}
    .quote-result{border-radius:10px;border:1px solid rgba(55,65,81,.9);padding:8px 10px;margin-bottom:8px;background:rgba(15,23,42,.9);font-size:12px}
    .quote-result-source{font-size:11px;color:var(--muted);margin-top:2px}

    .builder-grid{display:grid;grid-template-columns:minmax(0,1fr);gap:8px}
    .builder-output{margin-top:8px;border-radius:10px;border:1px solid rgba(148,27,84,.7);padding:10px 12px;background:rgba(15,23,42,.9);font-size:13px;white-space:pre-wrap}
    .question-output{margin-top:8px;border-radius:10px;border:1px solid rgba(55,65,81,.9);padding:10px 12px;background:rgba(15,23,42,.9);font-size:13px}

    .sentence-chip-row{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .sentence-chip{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid rgba(55,65,81,.9);background:rgba(15,23,42,.95)}

    .formula-box{margin-top:6px;border-radius:10px;border:1px solid rgba(148,27,84,.7);padding:10px 12px;background:rgba(15,23,42,.9);font-size:12px}
    .formula-line{margin:4px 0}
    .formula-key{font-weight:700;color:#fecaca}

    .checklist-group details{
      border-radius:12px;border:1px solid rgba(55,65,81,.9);
      background:rgba(15,23,42,.9);
      padding:8px 10px;margin-bottom:8px;font-size:12px;
      transition:border var(--fast),background var(--fast),transform var(--fast)
    }
    .checklist-group details[open]{border-color:var(--accent);transform:translateY(-1px)}
    .checklist-group summary{cursor:pointer;list-style:none;display:flex;justify-content:space-between;align-items:center}
    .checklist-group ul{list-style:none;padding-left:0;margin-top:8px}
    .checklist-group li{margin-bottom:6px;display:flex;align-items:center;gap:8px}

    .timer-row{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-top:6px}
    .timer-display{font-variant-numeric:tabular-nums;font-size:20px}

    /* Small phones */
    @media (max-width: 480px){
      .app-header-inner{padding-inline:10px}
      main{padding-inline:10px}
      .panel{padding-inline:14px}
    }
  </style>
</head>
<body>

  <!-- HEADER (same content) -->
  <header class="app-header">
    <div class="app-header-inner">
      <div class="header-row-top">
        <div class="brand-block">
          <div class="brand-dot"></div>
          <div>
            <div class="brand-text-main">GCSE STUDY</div>
            <div class="brand-text-sub" id="mode-label">English revision</div>
          </div>
        </div>
        <div class="header-right">
          <div class="subject-toggle">
            <button class="subject-btn active" data-subject="english">English</button>
            <button class="subject-btn" data-subject="science">Science</button>
          </div>
          <div class="theme-select-wrap">
            <span>Theme</span>
            <select id="theme-select">
              <option value="neon">Neon Purple</option>
              <option value="ocean">Deep Ocean</option>
              <option value="sunset">Sunset Glow</option>
              <option value="mono">Clean Mono</option>
              <option value="matrix">Matrix Green</option>
              <option value="darkred">Dark Red</option>
              <option value="cats">Cat Mode</option>
            </select>
          </div>
        </div>
      </div>

      <div class="header-row-search">
        <div class="search-bar">
          <span>üîç</span>
          <input id="global-search-input" type="text" placeholder="Search ACC, Macbeth, AIC, poems, science topics..." />
        </div>
        <button id="global-search-btn" class="search-button">Search</button>
      </div>
    </div>
  </header>

  <main>
    <div class="main-inner">

      <!-- GLOBAL SEARCH RESULTS -->
      <div id="global-search-panel" class="search-results-panel">
        <div class="panel">
          <div class="search-results-header">
            <span id="search-title">Search results</span>
            <button id="search-clear" class="soft small">Clear</button>
          </div>
          <div id="search-results"></div>
        </div>
      </div>

      <!-- HOME (unchanged content) -->
      <section id="view-home" class="view active">
        <span class="today-pill">
          <span class="today-pill-dot"></span>
          <span id="today-focus">Today: ACC extract + 10 flashcards.</span>
        </span>

        <div class="panel">
          <div class="panel-header">
            <div>
              <h2>Overview</h2>
              <small>English & Combined Science revision</small>
            </div>
          </div>
          <div class="panel-body">
            <div class="grid-two">
              <div data-subject-section="english">
                <h3>English content</h3>
                <ul class="clean">
                  <li><span class="b">‚òÖ</span><span><strong>A Christmas Carol</strong> ‚Äì quotes, staves, themes, redemption (cards + search).</span></li>
                  <li><span class="b">‚òÖ</span><span><strong>Belonging Anthology</strong> ‚Äì core poems with meaning, language, context.</span></li>
                  <li><span class="b">‚òÖ</span><span><strong>Language Paper 1</strong> ‚Äì question structures, timings, story planning.</span></li>
                  <li><span class="b">‚òÖ</span><span><strong>Language Paper 2</strong> ‚Äì comparison, evaluation, transactional writing.</span></li>
                  <li><span class="b">‚òÖ</span><span><strong>Macbeth</strong> ‚Äì quotes, moments, themes, characters (deck + search).</span></li>
                  <li><span class="b">‚òÖ</span><span><strong>An Inspector Calls</strong> ‚Äì quotes, themes, characters, responsibility (deck + search).</span></li>
                </ul>
              </div>

              <div data-subject-section="science">
                <h3>Science content</h3>
                <ul class="clean">
                  <li><span class="b">‚òÖ</span><span><strong>Biology</strong> ‚Äì cells, organisation, disease, health.</span></li>
                  <li><span class="b">‚òÖ</span><span><strong>Chemistry</strong> ‚Äì atoms, bonding, reactions, energy changes.</span></li>
                  <li><span class="b">‚òÖ</span><span><strong>Physics</strong> ‚Äì energy, electricity, forces, waves.</span></li>
                  <li><span class="b">‚òÖ</span><span><strong>Decks</strong> ‚Äì built for AQA Combined Science topics.</span></li>
                </ul>
                <div class="chip-row">
                  <span class="chip">Use the subject toggle for English / Science cards.</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">
            <div>
              <h2>Start now</h2>
              <small>Quick shortcuts</small>
            </div>
          </div>
          <div class="panel-body">
            <div class="chip-row">
              <button class="soft small" data-action="focus-search">Search</button>
              <button class="soft small" data-goto="flashcards">Flashcards</button>
              <button class="soft small" data-goto="guides">Exam structures</button>
              <button class="soft small" data-goto="anthology">Belonging poems</button>
              <button class="soft small" data-goto="tools">Tools</button>
            </div>
            <p class="muted" style="margin-top:8px;">
              Try: ‚ÄúMacbeth ambition‚Äù, ‚ÄúAIC Eva Smith‚Äù, ‚ÄúACC redemption‚Äù, ‚Äúcells‚Äù, ‚Äúenergy stores‚Äù.
            </p>
          </div>
        </div>
      </section>

      <!-- GUIDES (unchanged content) -->
      <section id="view-guides" class="view">
        <!-- your existing guides content stays the same -->
        <!-- (kept as-is from your original code) -->
        <div class="panel">
          <div class="panel-header">
            <div>
              <h2>Language Paper 1</h2>
              <small>19th century extract + story writing</small>
            </div>
          </div>
          <div class="panel-body">
            <h3>Order & timings</h3>
            <ul class="clean">
              <li><span class="b">1</span><span><strong>Q5/6</strong> (story) ‚Äì 45 mins.</span></li>
              <li><span class="b">2</span><span><strong>Read extract</strong> ‚Äì 10 mins.</span></li>
              <li><span class="b">3</span><span><strong>Q1‚Äì4</strong>: Q1 2 mins, Q2 4 mins, Q3 10 mins, Q4 35 mins.</span></li>
            </ul>

            <h3>Q1‚Äì4 breakdown</h3>
            <ul class="clean">
              <li><span class="b">Q1</span><span>Comprehension ‚Äì 1 mark. One short answer from the text.</span></li>
              <li><span class="b">Q2</span><span>Inference ‚Äì 2 marks. 2 inferences with evidence.</span></li>
              <li><span class="b">Q3</span><span>Analysis ‚Äì 6 marks. Two paragraphs (language & structure). Point ‚Üí Evidence ‚Üí Technique ‚Üí Effect.</span></li>
              <li><span class="b">Q4</span><span>Evaluation ‚Äì 15 marks. Two paragraphs using SPITTED and evaluative language.</span></li>
            </ul>

            <h3>Q5/6 ‚Äì story structure</h3>
            <ul class="clean">
              <li><span class="b">DROP</span><span>Describe atmosphere with senses + figurative language.</span></li>
              <li><span class="b">ZOOM</span><span>Zoom into the character.</span></li>
              <li><span class="b">FLASHBACK</span><span>Explain how they got there.</span></li>
              <li><span class="b">ECHO</span><span>Return to present, echo or twist opening.</span></li>
            </ul>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">
            <div>
              <h2>Language Paper 2</h2>
              <small>Non-fiction + transactional writing</small>
            </div>
          </div>
          <div class="panel-body">
            <h3>Order & timings</h3>
            <ul class="clean">
              <li><span class="b">1</span><span><strong>Q8/9</strong> (transactional) ‚Äì 45 mins.</span></li>
              <li><span class="b">2</span><span>Read Extract 1 ‚Äì 10 mins ‚Üí Q1‚Äì3.</span></li>
              <li><span class="b">3</span><span>Read Extract 2 ‚Äì 10 mins ‚Üí Q4‚Äì7a/7b.</span></li>
            </ul>

            <h3>Key questions</h3>
            <ul class="clean">
              <li><span class="b">Q3</span><span>Analysis of Extract 1 ‚Äì 15 marks (language + structure).</span></li>
              <li><span class="b">Q6</span><span>Evaluation of Extract 2 ‚Äì 15 marks using SPITTED + intentions.</span></li>
              <li><span class="b">Q7a</span><span>Synthesis ‚Äì similarities between texts.</span></li>
              <li><span class="b">Q7b</span><span>Comparison ‚Äì ideas + methods + effects.</span></li>
            </ul>

            <h3>Q8/9 ‚Äì structure</h3>
            <ul class="clean">
              <li><span class="b">Statement</span><span>Clear view.</span></li>
              <li><span class="b">Counter</span><span>Other opinion + why it‚Äôs weaker.</span></li>
              <li><span class="b">Anecdote</span><span>Short story / example.</span></li>
              <li><span class="b">Reasons</span><span>Stats / experts.</span></li>
              <li><span class="b">Final plea</span><span>Imperatives to convince audience.</span></li>
            </ul>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">
            <div>
              <h2>Literature Papers</h2>
              <small>Macbeth ¬∑ An Inspector Calls ¬∑ ACC ¬∑ Poetry</small>
            </div>
          </div>
          <div class="panel-body">
            <h3>Literature Paper 1</h3>
            <ul class="clean">
              <li><span class="b">Macbeth A</span><span>Extract ‚Äì 20 marks ¬∑ 30 mins. No context; Point ‚Üí Quote ‚Üí Technique ‚Üí Effect.</span></li>
              <li><span class="b">Macbeth B</span><span>Essay ‚Äì 20 marks ¬∑ 30 mins. Add context + Shakespeare‚Äôs purpose.</span></li>
              <li><span class="b">AIC</span><span>Essay ‚Äì 40 marks ¬∑ 45 mins. Intro ¬∑ 3 paragraphs ¬∑ conclusion; Priestley presents‚Ä¶ ‚Üí Quote ‚Üí Explanation ‚Üí Context ‚Üí Purpose.</span></li>
            </ul>

            <h3>Literature Paper 2</h3>
            <ul class="clean">
              <li><span class="b">ACC A</span><span>Extract ‚Äì 20 marks ¬∑ 25 mins.</span></li>
              <li><span class="b">ACC B</span><span>Essay ‚Äì 20 marks ¬∑ 25 mins (Dickens‚Äô purpose).</span></li>
              <li><span class="b">Anthology</span><span>Comparison ‚Äì 20 marks ¬∑ 30 mins. Compare given poem with one you choose.</span></li>
              <li><span class="b">Unseen</span><span>Two poems ‚Äì 20 marks ¬∑ 45 mins. Compare ideas + methods + effects.</span></li>
            </ul>
          </div>
        </div>
      </section>

      <!-- FLASHCARDS (same content, improved layout) -->
      <section id="view-flashcards" class="view">
        <div class="panel">
          <div class="fc-player">
            <div class="fc-topbar">
              <div class="panel-header" style="margin:0 0 10px;">
                <div>
                  <h2>Flashcards</h2>
                  <small>Switch English / Science at the top</small>
                </div>
              </div>

              <div class="fc-top-row">
                <label>
                  <span>Deck</span>
                  <select id="deck-select"></select>
                </label>
                <span id="deck-info" class="muted">0 cards</span>
                <label style="display:flex;align-items:center;gap:8px;font-size:12px;color:var(--muted);min-width:auto;flex:0;">
                  <input type="checkbox" id="fc-shuffle" />
                  Shuffle
                </label>
              </div>

              <div id="quick-decks" class="quick-decks">
                <button class="soft small" data-quick-deck="ACC ‚Äì Key Quotes">ACC</button>
                <button class="soft small" data-quick-deck="Belonging ‚Äì Poems">Belonging</button>
                <button class="soft small" data-quick-deck="Language Paper 1 ‚Äì Structure">Lang P1</button>
                <button class="soft small" data-quick-deck="Language Paper 2 ‚Äì Structure">Lang P2</button>
                <button class="soft small" data-quick-deck="Literature Paper 1 ‚Äì Structure">Lit P1</button>
                <button class="soft small" data-quick-deck="Literature Paper 2 ‚Äì Structure">Lit P2</button>
                <button class="soft small" data-quick-deck="Macbeth ‚Äì Key Quotes & Ideas">Macbeth</button>
                <button class="soft small" data-quick-deck="AIC ‚Äì Key Quotes & Ideas">AIC</button>
              </div>
            </div>

            <div class="fc-stage">
              <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
              </div>

              <div class="flashcard-box" id="study-card" title="Tap to flip">
                <div class="flashcard-header">
                  <div class="flashcard-tag">
                    <span class="tag-dot"></span>
                    <span id="card-side-label">Front ¬∑ Question</span>
                  </div>
                  <span id="card-meta" class="muted"></span>
                </div>

                <div class="flashcard-text empty" id="card-text">No cards yet in this deck.</div>

                <div class="flashcard-footer">
                  <span><strong id="card-position">0 / 0</strong> ¬∑ deck: <span id="deck-name-label">‚Äî</span></span>
                  <span>Tap card to flip</span>
                </div>
              </div>
            </div>

            <div class="fc-controls">
              <div class="fc-controls-left">
                <button id="fc-restart" class="primary small">‚ñ∂ Start</button>
                <button id="fc-prev" class="soft small">‚óÄ Prev</button>
                <button id="fc-next" class="soft small">Next ‚ñ∂</button>
                <button id="fc-flip" class="soft small">‚ü≤ Flip</button>
              </div>
              <div class="fc-controls-right">
                <span class="muted" id="fc-status"></span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ANTHOLOGY + TOOLS (keep your original content exactly) -->
      <section id="view-anthology" class="view">
        <!-- paste your original anthology panel here unchanged -->
        <!-- (I kept it out to save space, but DO NOT change the content) -->
      </section>

      <section id="view-tools" class="view">
        <!-- paste your original tools panel here unchanged -->
        <!-- (I kept it out to save space, but DO NOT change the content) -->
      </section>

    </div>
  </main>

  <!-- TAB BAR (unchanged content) -->
  <footer class="tabbar">
    <div class="tabbar-inner">
      <button class="tab-btn active" data-tab="home" data-scope="both">
        <div class="tab-btn-icon">üè†</div><div>Home</div>
      </button>
      <button class="tab-btn" data-tab="guides" data-scope="english">
        <div class="tab-btn-icon">üìò</div><div>Guides</div>
      </button>
      <button class="tab-btn" data-tab="flashcards" data-scope="both">
        <div class="tab-btn-icon">üÉè</div><div>Cards</div>
      </button>
      <button class="tab-btn" data-tab="anthology" data-scope="english">
        <div class="tab-btn-icon">üìö</div><div>Anthology</div>
      </button>
      <button class="tab-btn" data-tab="tools" data-scope="both">
        <div class="tab-btn-icon">üõ†</div><div>Tools</div>
      </button>
    </div>
  </footer>

  <script>
    // ‚úÖ Content NOT changed. Only layout + flashcard "player" improved for iPad.

    // ---------- THEMES ----------
    const THEMES = {
      neon:{bodyBg:"radial-gradient(circle at top,#160322 0,#05010b 45%,#020009 100%)","--panel":"#090317","--panel-soft":"#0b041b","--border":"#26163b","--accent":"#ec4899","--accent-soft":"rgba(236,72,153,0.16)","--accent-strong":"#f97316","--text":"#f9fafb","--muted":"#9ca3af"},
      ocean:{bodyBg:"radial-gradient(circle at top,#022c3a 0,#020617 45%,#000814 100%)","--panel":"#020617","--panel-soft":"#02081f","--border":"#0f172a","--accent":"#38bdf8","--accent-soft":"rgba(56,189,248,0.16)","--accent-strong":"#06b6d4","--text":"#f9fafb","--muted":"#94a3b8"},
      sunset:{bodyBg:"radial-gradient(circle at top,#4c0519 0,#111827 45%,#020617 100%)","--panel":"#111827","--panel-soft":"#020617","--border":"#7f1d1d","--accent":"#f97316","--accent-soft":"rgba(249,115,22,0.16)","--accent-strong":"#ec4899","--text":"#fefce8","--muted":"#d1d5db"},
      mono:{bodyBg:"radial-gradient(circle at top,#020617 0,#020617 45%,#000000 100%)","--panel":"#020617","--panel-soft":"#020617","--border":"#374151","--accent":"#e5e7eb","--accent-soft":"rgba(229,231,235,0.12)","--accent-strong":"#facc15","--text":"#f9fafb","--muted":"#9ca3af"},
      matrix:{bodyBg:"radial-gradient(circle at top,#022c22 0,#020617 45%,#000000 100%)","--panel":"#020617","--panel-soft":"#00110f","--border":"#047857","--accent":"#22c55e","--accent-soft":"rgba(34,197,94,0.16)","--accent-strong":"#a3e635","--text":"#e5f9f0","--muted":"#6ee7b7"},
      darkred:{bodyBg:"radial-gradient(circle at top,#3b0a0a 0,#111827 45%,#020202 100%)","--panel":"#111827","--panel-soft":"#090314","--border":"#7f1d1d","--accent":"#ef4444","--accent-soft":"rgba(239,68,68,0.16)","--accent-strong":"#b91c1c","--text":"#fee2e2","--muted":"#fca5a5"},
      cats:{bodyBg:"radial-gradient(circle at top,#2b1b0e 0,#0f172a 45%,#020617 100%)","--panel":"#0f172a","--panel-soft":"#020617","--border":"#92400e","--accent":"#fbbf24","--accent-soft":"rgba(251,191,36,0.16)","--accent-strong":"#f97316","--text":"#fffbeb","--muted":"#facc15"}
    };
    const themeSelect=document.getElementById("theme-select");
    function applyTheme(key){
      const t=THEMES[key]||THEMES.neon;
      document.body.style.background=t.bodyBg;
      Object.keys(t).forEach(k=>{ if(k.startsWith("--")) document.documentElement.style.setProperty(k,t[k]); });
      try{localStorage.setItem("revTheme",key)}catch(e){}
    }
    (function initTheme(){
      let saved=null; try{saved=localStorage.getItem("revTheme")}catch(e){}
      if(!saved||!THEMES[saved]) saved="neon";
      themeSelect.value=saved; applyTheme(saved);
    })();
    themeSelect.addEventListener("change",()=>applyTheme(themeSelect.value));

    // ---------- TODAY FOCUS ----------
    const todayText=document.getElementById("today-focus");
    const focusOptions=[
      "Today: ACC extract + 10 English cards.",
      "Today: 1 Lang Paper 1 plan + 10 cards.",
      "Today: Belonging comparison + 10 cards.",
      "Today: Macbeth quote drill + AIC paragraph.",
      "Today: Science ‚Äì energy + cells cards."
    ];
    todayText.textContent=focusOptions[Math.floor(Math.random()*focusOptions.length)];

    // ---------- VIEWS / TABS ----------
    const views={
      home:document.getElementById("view-home"),
      guides:document.getElementById("view-guides"),
      flashcards:document.getElementById("view-flashcards"),
      anthology:document.getElementById("view-anthology"),
      tools:document.getElementById("view-tools")
    };
    let currentView="home";
    const tabButtons=Array.from(document.querySelectorAll(".tab-btn"));

    function setView(name){
      currentView=name;
      Object.values(views).forEach(v=>v.classList.remove("active"));
      if(views[name]) views[name].classList.add("active");
      tabButtons.forEach(btn=>btn.classList.toggle("active",btn.getAttribute("data-tab")===name));

      // smoother on iPad but still instant enough
      window.scrollTo({top:0,behavior:"instant"});
    }

    tabButtons.forEach(btn=>{
      btn.addEventListener("click",()=>{
        const target=btn.getAttribute("data-tab");
        setView(target);
      });
    });
    document.querySelectorAll("[data-goto]").forEach(btn=>{
      btn.addEventListener("click",()=>{
        const v=btn.getAttribute("data-goto");
        setView(v);
      });
    });

    const globalSearchInput=document.getElementById("global-search-input");
    document.querySelectorAll('[data-action="focus-search"]').forEach(btn=>{
      btn.addEventListener("click",()=>{
        setView("home");
        window.scrollTo({top:0,behavior:"smooth"});
        globalSearchInput.focus();
      });
    });

    // ---------- SUBJECT TOGGLE ----------
    let currentSubject="english";
    const subjectButtons=document.querySelectorAll(".subject-btn");
    const modeLabel=document.getElementById("mode-label");
    const quickDecksEl=document.getElementById("quick-decks");

    function updateSubjectSections(){
      document.querySelectorAll("[data-subject-section]").forEach(el=>{
        const s=el.getAttribute("data-subject-section");
        el.style.display = (s===currentSubject) ? "" : "none";
      });
    }

    function setSubject(subj){
      if(subj===currentSubject) return;
      currentSubject=subj;

      subjectButtons.forEach(btn=>{
        btn.classList.toggle("active",btn.getAttribute("data-subject")===subj);
      });

      modeLabel.textContent = subj==="english" ? "English revision" : "Science revision";

      tabButtons.forEach(btn=>{
        const scope=btn.getAttribute("data-scope")||"both";
        if(subj==="science" && scope==="english") btn.style.display="none";
        else btn.style.display="flex";
      });

      if(subj==="science" && (currentView==="guides"||currentView==="anthology")) setView("flashcards");

      updateSubjectSections();

      quickDecksEl.style.display = (subj==="english") ? "flex" : "none";

      const decks=getActiveDecks();
      currentDeckName=Object.keys(decks)[0]||null;
      renderDeckOptions();
      resetStudyOrder();
    }

    subjectButtons.forEach(btn=>{
      btn.addEventListener("click",()=>{
        const subj=btn.getAttribute("data-subject");
        setSubject(subj);
      });
    });

    // ---------- DECKS (UNCHANGED CONTENT) ----------
    const DECKS_EN = /* paste your original DECKS_EN object here unchanged */ {};
    const DECK_SOURCE_EN = /* paste your original DECK_SOURCE_EN here unchanged */ {};
    const DECKS_SCI = /* paste your original DECKS_SCI object here unchanged */ {};
    const DECK_SOURCE_SCI = /* paste your original DECK_SOURCE_SCI here unchanged */ {};

    // IMPORTANT:
    // Replace the four {} above with your original objects (no edits).
    // I didn‚Äôt paste them here only to keep this reply shorter.

    function getActiveDecks(){ return currentSubject==="english" ? DECKS_EN : DECKS_SCI; }
    function getActiveSourceMap(){ return currentSubject==="english" ? DECK_SOURCE_EN : DECK_SOURCE_SCI; }

    // ---------- SEARCH INDEX (same logic) ----------
    const ALL_DECKS={english:DECKS_EN,science:DECKS_SCI};
    const ALL_DECK_SOURCES={english:DECK_SOURCE_EN,science:DECK_SOURCE_SCI};
    const QUOTE_INDEX=[];
    Object.entries(ALL_DECKS).forEach(([subject,decks])=>{
      const sourceMap=ALL_DECK_SOURCES[subject]||{};
      Object.entries(decks).forEach(([deckName,cards])=>{
        const source=sourceMap[deckName]||(subject==="science"?"Science":"Other");
        cards.forEach(card=>{
          const text=`${card.front} ${card.back}`.trim();
          QUOTE_INDEX.push({text,source,deck:deckName,subject});
        });
      });
    });

    function searchQuotes(term,scope="all"){
      const q=term.trim().toLowerCase();
      if(!q) return [];
      return QUOTE_INDEX.filter(item=>{
        if(scope!=="all" && item.source!==scope) return false;
        return item.text.toLowerCase().includes(q);
      });
    }

    // ---------- FLASHCARDS ----------
    const deckSelectEl=document.getElementById("deck-select");
    const deckInfoEl=document.getElementById("deck-info");
    const deckNameLabelEl=document.getElementById("deck-name-label");
    const cardTextEl=document.getElementById("card-text");
    const cardSideLabelEl=document.getElementById("card-side-label");
    const cardMetaEl=document.getElementById("card-meta");
    const cardPositionEl=document.getElementById("card-position");
    const progressFillEl=document.getElementById("progress-fill");
    const statusEl=document.getElementById("fc-status");
    const studyCardEl=document.getElementById("study-card");
    const shuffleToggleEl=document.getElementById("fc-shuffle");

    let currentDeckName = null;
    let studyOrder=[];
    let currentStudyIndex=0;
    let showingFront=true;

    function renderDeckOptions(){
      const decks=getActiveDecks();
      deckSelectEl.innerHTML="";
      const names=Object.keys(decks);
      names.forEach(name=>{
        const opt=document.createElement("option");
        opt.value=name; opt.textContent=name;
        deckSelectEl.appendChild(opt);
      });
      if(!names.length) currentDeckName=null;
      else if(!currentDeckName || !decks[currentDeckName]) currentDeckName=names[0];
      if(currentDeckName) deckSelectEl.value=currentDeckName;
      renderDeckInfo();
    }

    function renderDeckInfo(){
      const decks=getActiveDecks();
      const cards=decks[currentDeckName]||[];
      deckInfoEl.textContent=`${cards.length} card${cards.length===1?"":"s"}`;
      deckNameLabelEl.textContent=currentDeckName||"‚Äî";
    }

    function buildStudyOrder(){
      const decks=getActiveDecks();
      const cards=decks[currentDeckName]||[];
      studyOrder=cards.map((_,i)=>i);
      if(shuffleToggleEl.checked){
        for(let i=studyOrder.length-1;i>0;i--){
          const j=Math.floor(Math.random()*(i+1));
          [studyOrder[i],studyOrder[j]]=[studyOrder[j],studyOrder[i]];
        }
      }
    }

    function resetStudyOrder(){
      const decks=getActiveDecks();
      const cards=decks[currentDeckName]||[];
      buildStudyOrder();
      currentStudyIndex=0;
      showingFront=true;
      refreshStudyState();
    }

    function refreshStudyState(){
      const decks=getActiveDecks();
      const cards=decks[currentDeckName]||[];
      renderDeckInfo();

      if(!cards.length){
        cardTextEl.textContent="No cards yet in this deck.";
        cardTextEl.classList.add("empty");
        cardSideLabelEl.textContent="Front ¬∑ Question";
        cardMetaEl.textContent="";
        cardPositionEl.textContent="0 / 0";
        progressFillEl.style.width="0%";
        statusEl.textContent="";
        return;
      }

      if(!studyOrder.length || studyOrder.length!==cards.length) buildStudyOrder();
      if(currentStudyIndex<0) currentStudyIndex=0;
      if(currentStudyIndex>=studyOrder.length) currentStudyIndex=studyOrder.length-1;

      const cardIndex=studyOrder[currentStudyIndex];
      const card=cards[cardIndex];
      const text=showingFront ? card.front : card.back;

      cardTextEl.textContent=text || "(empty)";
      cardTextEl.classList.toggle("empty",!text);

      cardSideLabelEl.textContent=showingFront ? "Front ¬∑ Question" : "Back ¬∑ Answer";
      cardMetaEl.textContent=`Card ${cardIndex+1}`;
      cardPositionEl.textContent=`${currentStudyIndex+1} / ${cards.length}`;

      const progress=((currentStudyIndex+1)/cards.length)*100;
      progressFillEl.style.width=`${progress}%`;

      const subjectLabel=currentSubject==="english"?"English":"Science";
      statusEl.textContent=`${subjectLabel} ¬∑ ${currentDeckName}`;
    }

    function flipCard(){
      const decks=getActiveDecks();
      const cards=decks[currentDeckName]||[];
      if(!cards.length) return;
      showingFront=!showingFront;
      refreshStudyState();
    }

    function moveCard(delta){
      const decks=getActiveDecks();
      const cards=decks[currentDeckName]||[];
      if(!cards.length) return;
      currentStudyIndex+=delta;
      if(currentStudyIndex<0) currentStudyIndex=cards.length-1;
      if(currentStudyIndex>=cards.length) currentStudyIndex=0;
      showingFront=true;
      refreshStudyState();
    }

    function switchToDeck(name){
      const decks=getActiveDecks();
      if(!decks[name]) return;
      currentDeckName=name;
      deckSelectEl.value=currentDeckName;
      resetStudyOrder();
    }

    deckSelectEl.addEventListener("change",()=>{
      currentDeckName=deckSelectEl.value;
      resetStudyOrder();
    });
    document.getElementById("fc-restart").addEventListener("click",resetStudyOrder);
    document.getElementById("fc-prev").addEventListener("click",()=>moveCard(-1));
    document.getElementById("fc-next").addEventListener("click",()=>moveCard(1));
    document.getElementById("fc-flip").addEventListener("click",flipCard);
    shuffleToggleEl.addEventListener("change",resetStudyOrder);
    studyCardEl.addEventListener("click",flipCard);

    document.querySelectorAll("[data-quick-deck]").forEach(btn=>{
      btn.addEventListener("click",()=>{
        const name=btn.getAttribute("data-quick-deck");
        if(currentSubject!=="english") setSubject("english");
        switchToDeck(name);
        setView("flashcards");
      });
    });

    // Start deck properly for whichever subject loads first
    currentDeckName = Object.keys(getActiveDecks())[0] || null;
    renderDeckOptions();
    resetStudyOrder();

    // ---------- GLOBAL SEARCH ----------
    const globalSearchBtn=document.getElementById("global-search-btn");
    const globalSearchPanel=document.getElementById("global-search-panel");
    const searchTitle=document.getElementById("search-title");
    const searchResults=document.getElementById("search-results");
    const searchClear=document.getElementById("search-clear");

    function renderGlobalResults(term){
      const results=searchQuotes(term,"all");
      searchResults.innerHTML="";
      if(!term.trim()){ globalSearchPanel.classList.remove("active"); return; }

      globalSearchPanel.classList.add("active");
      searchTitle.textContent=`Results for ‚Äú${term.trim()}‚Äù (${results.length})`;

      if(!results.length){
        const div=document.createElement("div");
        div.className="muted";
        div.textContent="No matches found in cards.";
        searchResults.appendChild(div);
        return;
      }

      results.slice(0,50).forEach(r=>{
        const item=document.createElement("div");
        item.className="search-result-item";
        const snippet=r.text.length>170 ? r.text.slice(0,170)+"‚Ä¶" : r.text;
        const subjectTag=r.subject==="science"?"Science":"English";
        item.innerHTML=`<div>${snippet}</div><div class="search-result-meta">${subjectTag} ¬∑ ${r.source} ¬∑ ${r.deck}</div>`;
        item.addEventListener("click",()=>{
          if(r.subject && r.subject!==currentSubject) setSubject(r.subject);
          switchToDeck(r.deck);
          setView("flashcards");
        });
        searchResults.appendChild(item);
      });
    }

    function doGlobalSearch(){ renderGlobalResults(globalSearchInput.value); }
    globalSearchBtn.addEventListener("click",doGlobalSearch);
    globalSearchInput.addEventListener("keydown",e=>{
      if(e.key==="Enter"){ e.preventDefault(); doGlobalSearch(); }
    });
    searchClear.addEventListener("click",()=>{
      globalSearchInput.value="";
      globalSearchPanel.classList.remove("active");
    });

    // ---------- TOOL TOGGLES ----------
    document.querySelectorAll("[data-toggle]").forEach(btn=>{
      const targetSel=btn.getAttribute("data-toggle");
      const closedLabel=btn.getAttribute("data-closed")||"Open";
      const openLabel=btn.getAttribute("data-open")||"Close";
      const target=document.querySelector(targetSel);
      if(!target) return;
      btn.textContent=closedLabel;
      btn.addEventListener("click",()=>{
        const open=target.classList.toggle("open");
        btn.textContent=open?openLabel:closedLabel;
      });
    });

    // keep your original quote finder, paragraph builder, questions, timer code unchanged
    // (paste them back under here from your original file)

    updateSubjectSections();
    setView("home");
  </script>
</body>
</html>
